# yaml-language-server: $schema=../lua_script.schema.json
type: behavior
name: gravity
description: |
  Apply gravitational acceleration to entity velocity.

  Applies downward acceleration to velocity, then moves entity by velocity.
  Handles both vertical and horizontal velocity for projectile motion.
version: "1.0"
tags: [physics, motion]

config:
  acceleration:
    type: float
    description: Gravity in pixels/second^2
    default: 800
    min: 0

provides:
  hooks:
    - on_update

requires:
  api: [get_config, get_x, get_y, get_vx, get_vy, set_x, set_y, set_vy]

examples:
  - title: Standard gravity
    yaml: |
      behaviors: [gravity, destroy_offscreen]
      behavior_config:
        gravity:
          acceleration: 800

  - title: Low gravity
    yaml: |
      behaviors: [gravity]
      behavior_config:
        gravity:
          acceleration: 200

lua: |
  local gravity = {}

  function gravity.on_update(entity_id, dt)
      local accel = ams.get_config(entity_id, "gravity", "acceleration", 800)

      -- Apply gravity to vertical velocity
      local vy = ams.get_vy(entity_id)
      vy = vy + accel * dt
      ams.set_vy(entity_id, vy)

      -- Move by velocity
      local x = ams.get_x(entity_id)
      local y = ams.get_y(entity_id)
      local vx = ams.get_vx(entity_id)

      x = x + vx * dt
      y = y + vy * dt

      ams.set_x(entity_id, x)
      ams.set_y(entity_id, y)
  end

  return gravity
