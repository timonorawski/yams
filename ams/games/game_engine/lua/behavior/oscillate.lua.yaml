# yaml-language-server: $schema=../lua_script.schema.json
type: behavior
name: oscillate
description: |
  Move entity side-to-side.

  Oscillates horizontally within a specified range.
version: "1.0"
tags: [motion, enemy]

config:
  speed:
    type: float
    description: Pixels per second of oscillation
    default: 40
    min: 0
  range:
    type: float
    description: Total horizontal range in pixels
    default: 50
    min: 0

provides:
  hooks:
    - on_spawn
    - on_update

requires:
  api: [get_config, get_prop, set_prop, get_x, set_x]

examples:
  - title: Basic oscillation
    yaml: |
      behaviors: [oscillate]
      behavior_config:
        oscillate:
          speed: 60
          range: 100

lua: |
  local oscillate = {}

  function oscillate.on_spawn(entity_id)
      -- Store initial position and direction
      ams.set_prop(entity_id, "oscillate_start_x", ams.get_x(entity_id))
      ams.set_prop(entity_id, "oscillate_direction", 1)  -- 1 = right, -1 = left
  end

  function oscillate.on_update(entity_id, dt)
      local speed = ams.get_config(entity_id, "oscillate", "speed", 40)
      local range = ams.get_config(entity_id, "oscillate", "range", 50)
      local half_range = range / 2

      local start_x = ams.get_prop(entity_id, "oscillate_start_x") or ams.get_x(entity_id)
      local direction = ams.get_prop(entity_id, "oscillate_direction") or 1

      local x = ams.get_x(entity_id)
      local new_x = x + speed * direction * dt

      -- Check bounds and reverse direction
      if new_x > start_x + half_range then
          new_x = start_x + half_range
          direction = -1
      elseif new_x < start_x - half_range then
          new_x = start_x - half_range
          direction = 1
      end

      ams.set_x(entity_id, new_x)
      ams.set_prop(entity_id, "oscillate_direction", direction)
  end

  return oscillate
