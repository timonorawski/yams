# BrickBreaker Ultimate - Unified Interactions Test
#
# This game definition validates the unified interactions system design.
# All entity interactions (collisions, input, screen bounds) use the same model.

name: "Brick Breaker Ultimate"
description: "Brick breaker using unified interaction system"
version: "0.1.0"

screen_width: 800
screen_height: 600
background_color: [20, 20, 30]

defaults:
  lives: 3

win_condition: destroy_all
win_target_type: brick
lose_on_player_death: true

# =============================================================================
# Assets
# =============================================================================

assets:
  sounds:
    paddle_hit: sounds/paddle_hit.wav
    wall_bounce: sounds/wall_bounce.wav
    brick_hit: sounds/brick_hit.wav
    brick_break: sounds/brick_break.wav
    shoot: sounds/shoot.wav
    player_hit: sounds/player_hit.wav

# =============================================================================
# Entity Types (with interactions as entity property)
# =============================================================================

entity_types:

  # paddle: Active paddle (after ball is launched)
  paddle:
    width: 120
    height: 15
    color: blue
    tags: [player]
    render:
      - shape: rectangle
        color: blue
        fill: true
      - shape: rectangle
        color: [100, 100, 255]
        fill: false
        line_width: 2

    interactions:
      # On click: start sliding toward click position
      pointer:
        - when:
            b.active: true
          action: set_target_x
          modifier:
            speed: 500
            stop_threshold: 5.0

      # Continuous: stop when reaching target
      screen:
        because: continuous
        action: stop_at_target
        modifier:
          threshold: 5.0

  # paddle_ready: Composite entity showing paddle+ball, transforms on click
  paddle_ready:
    extends: paddle
    tags: [player]
    render:
      # Paddle body
      - shape: rectangle
        color: blue
        fill: true
      - shape: rectangle
        color: [100, 100, 255]
        fill: false
        line_width: 2
      # Attached ball (centered above)
      - shape: circle
        color: white
        fill: true
        offset: [52, -20]  # center of paddle width (120/2 - 8), above
        size: [16, 16]

    interactions:
      pointer:
        # On click, set target AND launch
        - when:
            b.active: true
          action: set_target_x
        - when:
            b.active: true
          action: launch_transform
          modifier:
            angle_range: [-60, 60]  # Launch upward: left (-60°) to right (60°)
            speed: 300

  ball:
    width: 16
    height: 16
    color: white
    tags: [ball]
    render:
      - shape: circle
        color: white
        fill: true

    interactions:
      paddle:
        when:
          distance: 0
        action: bounce_paddle
        modifier:
          max_angle: 60

      brick:
        when:
          distance: 0
        action: bounce_reflect
        modifier:
          speed_increase: 5
          max_speed: 600

      screen:
        # Ball lost when exiting screen (bottom)
        - when:
            distance: 0
          because: exit
          action: ball_lost

        # Bounce off left wall (continuous - action checks position)
        - edges: [left]
          because: continuous
          action: bounce_horizontal

        # Bounce off right wall (continuous - action checks position)
        - edges: [right]
          because: continuous
          action: bounce_horizontal

        # Bounce off top wall (continuous - action checks position)
        - edges: [top]
          because: continuous
          action: bounce_vertical

  brick:
    width: 70
    height: 25
    color: gray
    tags: [enemy, brick]
    properties:
      hits_remaining: 1
      points: 100
    render:
      # Base brick fill
      - shape: rectangle
        color: $color  # Uses entity.color
        fill: true
      # Outline
      - shape: rectangle
        color: white
        fill: false
        line_width: 1
      # Damage overlay - darkens brick based on damage taken
      - shape: rectangle
        color: [0, 0, 0]
        fill: true
        alpha: $damage_ratio  # 0 = no damage, approaches 1 as damage increases
        # Only show for multi-hit bricks
        when:
          property: brick_max_hits
          compare: greater_than
          value: 1

    interactions:
      ball:
        when:
          distance: 0
        action: take_damage
        modifier:
          amount: 1

  brick_red:
    extends: brick
    color: red
    properties:
      points: 500

  brick_silver:
    extends: brick
    color: silver
    properties:
      hits_remaining: 3
      points: 400

  projectile:
    width: 8
    height: 8
    color: red
    tags: [projectile, hazard]
    render:
      - shape: circle
        color: red
        fill: true

    interactions:
      paddle:
        when:
          distance: 0
        action: hit_player
        modifier:
          sound: player_hit

      screen:
        edges: [top, bottom, left, right]
        action: destroy_self

# =============================================================================
# Player Configuration
# =============================================================================

player:
  type: paddle_ready  # Start with paddle_ready (ball attached visually)
  spawn: [340, 550]

# =============================================================================
# Default Layout
# =============================================================================

default_layout:
  name: "Classic"
  brick_grid:
    start_x: 65
    start_y: 60
    cols: 10
    rows: 5
    row_types:
      - brick
      - brick
      - brick_red
      - brick_red
      - brick_silver
